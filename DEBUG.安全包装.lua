--* 包装AddPriorityCallback和RemoveCallback，防止因回调函数报错导致游戏崩溃。
--对忏悔龙Repentogon不生效。
--控制台输入 lua Wrap() 启用安全包装，输入lua Unwrap() 关闭安全包装。
--重复输入该代码不会产生额外影响。多次Wrap、Unwrap不会额外生效。
--使用了debug调试库，可能会影响游戏性能。
if not(REPENTOGON or CALLBACK_HOOKED)then local D,F,I,M,O,R,Y,W,A,B,C,G,H=require('debug'),'Function',Isaac,ModCallbacks,{},function(f)return function(...)local s,r=pcall(f,...)if s then return r end end end,true,{}CALLBACK_HOOKED,A,B,C,G=Y,D.getlocal,D.setlocal,D.sethook,I.GetCallbacks function Wrap()if not H then for _,i in pairs(M)do for _,m in pairs(G(i))do local a,b=m[F]if not W[a]then b=O[a]or R(a)O[a],W[b],m[F]=b,a,b end end end C(function(_)local a,b=D.getinfo(2,'f').func if a==I.AddPriorityCallback then _,a=A(2,4)if not W[a]then b=O[a]or R(a)O[a],W[b]=b,a B(2,4,b)end elseif a==I.RemoveCallback then _,a=A(2,3)if not W[a]then B(2,3,O[a]or a)end end end,'c')H=Y end end function Unwrap()if H then C()for _,i in pairs(M)do for _,m in pairs(G(i))do m[F]=W[m[F]]or m[F]end end O,W,H={},{}end end end